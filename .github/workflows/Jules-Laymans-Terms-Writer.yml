name: Jules Layman's Terms Writer (Worker)

# Generates plain-language explanations of complex code
# Creates accessible documentation for non-technical stakeholders

on:
  workflow_call:
  workflow_dispatch:
    inputs:
      target_path:
        description: 'Path to analyze'
        required: false
        default: 'games/'
        type: string

permissions:
  contents: write
  pull-requests: write

concurrency:
  group: jules-laymans-terms-${{ github.repository }}
  cancel-in-progress: false

jobs:
  simplify-docs:
    name: Generate Plain Language Docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Analyze and Simplify
        id: analyze
        env:
          TARGET_PATH: ${{ inputs.target_path || 'games/' }}
        run: |
          DATE=$(date +%Y-%m-%d)
          DOCS_DIR="docs/plain_language"
          mkdir -p "$DOCS_DIR"

          OUTPUT_FILE="$DOCS_DIR/overview_${DATE}.md"

          echo "# Plain Language Overview" > "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"
          echo "*Generated: $DATE*" >> "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"
          echo "This document explains the codebase in simple terms." >> "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"

          # Summarize main directories
          echo "## What's in this repository?" >> "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"

          if [ -d "games" ]; then
            echo "### Games" >> "$OUTPUT_FILE"
            echo "This folder contains Python implementations of classic games." >> "$OUTPUT_FILE"
            echo "- Number of Python files: $(find games -name '*.py' 2>/dev/null | wc -l)" >> "$OUTPUT_FILE"
            echo "" >> "$OUTPUT_FILE"
          fi

          if [ -d "matlab" ]; then
            echo "### MATLAB" >> "$OUTPUT_FILE"
            echo "This folder contains MATLAB scripts for scientific computing and data analysis." >> "$OUTPUT_FILE"
            echo "- Number of MATLAB files: $(find matlab -name '*.m' 2>/dev/null | wc -l)" >> "$OUTPUT_FILE"
            echo "" >> "$OUTPUT_FILE"
          fi

          if [ -d "arduino" ]; then
            echo "### Arduino" >> "$OUTPUT_FILE"
            echo "This folder contains code for Arduino microcontrollers and hardware projects." >> "$OUTPUT_FILE"
            echo "" >> "$OUTPUT_FILE"
          fi

          if [ -d "javascript" ]; then
            echo "### JavaScript" >> "$OUTPUT_FILE"
            echo "This folder contains web-based implementations and utilities." >> "$OUTPUT_FILE"
            echo "" >> "$OUTPUT_FILE"
          fi

          echo "## How to Use" >> "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"
          echo "1. Each game folder typically has its own README with specific instructions" >> "$OUTPUT_FILE"
          echo "2. Python games can usually be run with: \`python game_name.py\`" >> "$OUTPUT_FILE"
          echo "3. Check the requirements.txt for any needed dependencies" >> "$OUTPUT_FILE"
          echo "" >> "$OUTPUT_FILE"
          echo "---" >> "$OUTPUT_FILE"
          echo "*Generated by Jules Layman's Terms Writer*" >> "$OUTPUT_FILE"

          echo "output_file=$OUTPUT_FILE" >> $GITHUB_OUTPUT

      - name: Commit Documentation
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: plain language overview"
          file_pattern: "docs/plain_language/*"

      - name: Summary
        run: |
          echo "## Jules Layman's Terms Writer" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Generated plain language documentation." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Output: ${{ steps.analyze.outputs.output_file }}" >> $GITHUB_STEP_SUMMARY
